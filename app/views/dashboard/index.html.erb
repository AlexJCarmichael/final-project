<h4><%= current_user.name %>'s Tavern </h4>

<div class='row'>
  <div class='col s12 m7'>
    <div class='row'>
      <div class='col s6'>
        <h5>Games</h5>
      </div>
      <div class='col s6'>
        <%= react_component('NewGame', controller: "game_sessions", redirect_controller: "game_sessions",
                            name: "session_name", sheet_id: 1, display_name: "New game",
                            placeholder: "Type in a game name") %>
      </div>
    </div>
  <div>
    <% @sessions.each do |session| %>
      <div class='card'>
        <h5 class='center plain'><%= link_to "#{session.session_name}", game_session_path("#{session.id}") %></h5>
        <div class='row'>
        <p>
          <div class='col s2 offset-s1'>
            <%= session.actors.count %>
            <i class="person-icon material-icons">portrait</i>
          </div>
          <div class='col s6 center'>
            <span class='session-border'><%= session.sheet_template.game_name %></span>
          </div>
          <div class='col s3'>
            <span class="right small-right-margin"><%=session.game_time.strftime("%A %l%P")%></span>
          </div>
        </p>
        </div>
        <% end %>
      </div>
    </div>
  </div>

  <h5 class='clicky-button'>Friends</h5>
  <div class='col s12 m4 offset-m1 md-top-margin'>
    <div class='hide-on-small-only expand-me'>
      <%#TODO: Change this to react ajax after project, currenly an a-tag that redirect_to back%>
      <%= react_component('UserSearch', buttonStyle: "center", divStyle: "card", headerText: "Request a friend", userInvite: true) %>
      <% if @friends.empty? %>
        <p class='card'>No user's have accepted a friend request</p>
      <% else %>
       <ul class="collection">
        <% @friends.each do |friend| %>
           <li class="collection-item avatar plain">
             <img src="<%= friend.photo_url %>" class="circle">
              <span class="title"><a class="opens-modal" href="#to-be-opened-modal"><%= "#{friend.name}" %></a>
                <div class="to-be-opened-modal modal">
                  <%= render partial: 'layouts/user_show', :locals => { :user => friend } %>
                </div>
              </span>
              <p><%= friend.user_name %></p>
            </li>
        <% end %>
        </ul>
      <% end %>
      <ul class="collection">
        <% @pending.each do |pend| %>
            <% if pend.user.name == current_user.name %>
              <li class="collection-item avatar plain">
                <img src="<%= pend.to_user.photo_url %>" class="circle">
                <span class="title"><a class="opens-modal" href="#to-be-opened-modal"><%= "#{pend.to_user.name}" %></a>
                  <div class="to-be-opened-modal modal">
                    <%= render partial: 'layouts/user_show', :locals => { :user => pend.to_user } %>
                  </div>
                </span>
                <p><%= pend.to_user.user_name %> <br>
                  Awaiting approval
                </p>
              </li>
            <% else %>
              <li class="collection-item avatar plain">
                <img src="<%= pend.user.photo_url %>" class="circle">
                <span class="title"><a class="opens-modal" href="#to-be-opened-modal"><%= "#{pend.user.name}" %></a>
                  <div class="to-be-opened-modal modal">
                    <%= render partial: 'layouts/user_show', :locals => { :user => pend.user } %>
                  </div>
                </span>
                <p><%= pend.user.user_name %> <br>
                  <%= link_to "Accept", acceptance_users_path(from: pend.user_id, to: current_user.id), method: :put %>
                  <span> or </span>
                  <%= link_to "Decline", denial_users_path(from: pend.user_id, to: current_user.id), method: :put %>
                </p>
              </li>
              <% end %>
        </ul>
      <% end %>
    </div>
  </div>
</div>
